# TrapperKeeper Test Utils

Trapperkeeper provides some [utility code](../test/puppetlabs/trapperkeeper/testutils)
for use in tests. The code is available in a separate "test" jar that you may depend
on by using a classifier in your project dependencies.

```clojure
  (defproject yourproject "1.0.0"
    ...
    :profiles {:test {:dependencies [[puppetlabs/trapperkeeper "x.y.z" :classifier "test"]]}})
```

## Logging

Some utilities to ensure that the correct logging messages are generated by your application code are located in
[logging.clj](../test/puppetlabs/trapperkeeper/testutils/logging.clj)

### with-test-logging

All logging messages generated by code executed using the `with-test-logging` macro are available for later inspection.
A simple example would be:

```clojure
(with-test-logging
  (log/info "hello log")
  (is (logged? #"^hello log$"))
  (is (logged? #"^hello log$" :info)))
```

In this code `(log/info "hello log")` generates the message `hello log` at the `INFO` level. The existence of this
message is then later tested by the `logged?` function.

### logged?

The `logged?` function always takes a regex as its first parameter, declared with Clojure's `#"pattern"` notation. If
this regex matches any line that has been logged within the body of a `with-test-logging` then `true` will be returned.

The optional second parameter is a keyword describing a log level to specifically search in. It currently can be one of
`:trace`, `:debug`, `:info`, `:warn`, `:error` or `:fatal`.